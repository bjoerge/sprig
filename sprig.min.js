(function(window,undefined){var $=window.jQuery||typeof require=="function"&&require("jquery")||function(){throw"Sprig requires jQuery"}();var prefix="sprig";var componentAttr="data-"+prefix+"-component";var readyStateAttr="data-"+prefix+"-ready-state";var selectors={component:"["+componentAttr+"]",unprocessed:"["+componentAttr+"]:not(["+readyStateAttr+"])",scheduled:"["+componentAttr+"]["+readyStateAttr+"=scheduled]",deferred:"["+componentAttr+"]["+readyStateAttr+"=deferred]",loading:"["+componentAttr+"]["+readyStateAttr+"=loading]",loaded:"["+componentAttr+"]["+readyStateAttr+"=loaded]"};selectors.forComponentDef=function(name){return"["+componentAttr+"="+name+"]"};function Component(el,parent){this.$el=$(el);this.el=this.$el[0];this.params=el.dataset;this.data={};this.children=[];this.parent=parent;if(parent)this.parent.children.push(this);this.registry={}}Component.prototype.define=function(name,opts){var myName=this.getName();var path=myName?myName+"."+name:name;var componentDef=this.registry[path]=new ComponentDef(path,opts);console.log(path);var $deferred=this.query(selectors.deferred);if($deferred.length>0){setTimeout(function(){this.load($deferred)}.bind(this),0)}return componentDef};Component.prototype.getName=function(){return this.$el.attr("data-sprig-component")};Component.prototype.parents=function(){var parents=[];var it=this.parent;while(it&&it.parent){parents.push(it);it=it.parent}return parents};Component.prototype.query=function(selector){return this.$el.find(selector)};Component.prototype.scan=function(){var $unprocessed=this.query(selectors.unprocessed);this.schedule($unprocessed);this.load($unprocessed);this.children.forEach(function(child){child.scan()})};Component.prototype.schedule=function($elements){$elements.attr("data-sprig-ready-state","scheduled")};Component.prototype.finalize=function(){this.$el.attr("data-sprig-ready-state","loaded");this.scan()};Component.prototype.findComponentDef=function(name){var it=this;while(it&&it.registry){if(it.registry[name])return it.registry[name];it=it.parent}return null};Component.prototype.load=function($elements){$elements.attr("data-sprig-ready-state","loading");var _this=this;var groups=$elements.toArray().reduce(function(groups,el){var componentName=el.dataset.sprigComponent;if(!_this.findComponentDef(componentName)){el.dataset.sprigReadyState="deferred";return groups}groups[componentName]||(groups[componentName]=[]);groups[componentName].push(new Component(el,_this));return groups},{});for(var componentName in groups)if(groups.hasOwnProperty(componentName)){var components=groups[componentName];var componentDef=_this.findComponentDef(componentName);if(componentDef.initializeMany){componentDef.initializeMany(components)}components.forEach(function(component){if(componentDef.initializeOne)componentDef.initializeOne(component);if(!componentDef.loadAsync)component.finalize()})}};function ComponentDef(name,opts){this.opts=opts||{};this.name=name;this.initializeOne=null;this.initializeMany=null;this.loadAsync=false}ComponentDef.prototype.initMany=function(func){this.initializeMany=func;return this};ComponentDef.prototype.initEach=function(func){this.initializeOne=func;return this};ComponentDef.prototype.async=function(){this.loadAsync=true;return this};var Sprig=new Component($("html"));Sprig.Component=Component;if(typeof exports!=="undefined"){module.exports=Sprig}else{window.Sprig=Sprig}})(typeof window!="undefined"?window:this);